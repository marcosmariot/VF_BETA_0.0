"use strict";(()=>{var e={};e.id=887,e.ids=[887],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},20629:e=>{e.exports=require("fs/promises")},55315:e=>{e.exports=require("path")},36492:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>j});var r={};s.r(r),s.d(r,{DELETE:()=>f,GET:()=>c,POST:()=>d});var o=s(49303),i=s(88716),n=s(60670),a=s(87070),u=s(20629),p=s(55315);let l=process.env.UPLOAD_DIR||"/tmp/uploads";async function c(e){try{let{searchParams:t}=new URL(e.url),s=t.get("userId")||"anonymous",r=(0,p.join)(l,s);try{let e=await (0,u.readdir)(r),t=[];for(let o of e){let e=(0,p.join)(r,o),i=await (0,u.stat)(e);t.push({id:o,name:o,size:i.size,type:function(e){switch(e.split(".").pop()?.toLowerCase()){case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";case"mp4":return"video/mp4";case"mp3":return"audio/mpeg";default:return"application/octet-stream"}}(o),uploadedAt:i.birthtime.toISOString(),url:`/api/files/${s}/${o}`})}return a.NextResponse.json({success:!0,files:t})}catch(e){return a.NextResponse.json({success:!0,files:[]})}}catch(e){return console.error("Error listing files:",e),a.NextResponse.json({success:!1,error:"Failed to list files"},{status:500})}}async function d(e){try{let t=await e.formData(),r=t.get("file"),o=t.get("userId")||"anonymous";if(!r)return a.NextResponse.json({success:!1,error:"No file provided"},{status:400});if(!["image/jpeg","image/png","image/webp","video/mp4","audio/mpeg"].includes(r.type))return a.NextResponse.json({success:!1,error:"File type not allowed"},{status:400});if(r.size>10485760)return a.NextResponse.json({success:!1,error:"File too large (max 10MB)"},{status:400});let i=(0,p.join)(l,o);try{await (0,u.readdir)(i)}catch{await s(20629).mkdir(i,{recursive:!0})}let n=Date.now(),c=r.name.split(".").pop(),d=`${n}.${c}`,f=(0,p.join)(i,d),m=await r.arrayBuffer(),g=Buffer.from(m);await (0,u.writeFile)(f,g);let j={id:d,name:r.name,size:r.size,type:r.type,uploadedAt:new Date().toISOString(),url:`/api/files/${o}/${d}`};return a.NextResponse.json({success:!0,file:j})}catch(e){return console.error("Error uploading file:",e),a.NextResponse.json({success:!1,error:"Failed to upload file"},{status:500})}}async function f(e){try{let{searchParams:t}=new URL(e.url),s=t.get("userId")||"anonymous",r=t.get("fileId");if(!r)return a.NextResponse.json({success:!1,error:"File ID required"},{status:400});let o=(0,p.join)(l,s,r);try{return await (0,u.unlink)(o),a.NextResponse.json({success:!0,message:"File deleted successfully"})}catch(e){return a.NextResponse.json({success:!1,error:"File not found"},{status:404})}}catch(e){return console.error("Error deleting file:",e),a.NextResponse.json({success:!1,error:"Failed to delete file"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/files/route",pathname:"/api/files",filename:"route",bundlePath:"app/api/files/route"},resolvedPagePath:"/home/ubuntu/vertical-fashion-project/app/api/files/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:j,serverHooks:x}=m,w="/api/files/route";function y(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:j})}},49303:(e,t,s)=>{e.exports=s(30517)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,70],()=>s(36492));module.exports=r})();