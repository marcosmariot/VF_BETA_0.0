"use strict";(()=>{var e={};e.id=936,e.ids=[936],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},20629:e=>{e.exports=require("fs/promises")},55315:e=>{e.exports=require("path")},35062:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>x,requestAsyncStorage:()=>j,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{DELETE:()=>g,GET:()=>p,POST:()=>d});var a=r(49303),n=r(88716),o=r(60670),i=r(87070),u=r(20629),c=r(55315);let l=process.env.GALLERY_DIR||"/tmp/gallery";async function p(e){try{let{searchParams:t}=new URL(e.url),s=t.get("userId")||"anonymous",a=t.get("month"),n=(0,c.join)(l,s);try{let e=await (0,u.readdir)(n),t=[];for(let o of e){if(o.endsWith(".json"))continue;let e=(0,c.join)(n,o),i=(await (0,u.stat)(e)).birthtime.toISOString();if(a&&!i.startsWith(a))continue;let l={};try{let e=(0,c.join)(n,`${o}.json`),t=await r(20629).readFile(e,"utf-8");l=JSON.parse(t)}catch{}t.push({id:o,name:o,url:`/api/gallery/${s}/${o}`,createdAt:i,type:m(o),metadata:l})}return t.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()),i.NextResponse.json({success:!0,creations:t})}catch(e){return i.NextResponse.json({success:!0,creations:[]})}}catch(e){return console.error("Error listing creations:",e),i.NextResponse.json({success:!1,error:"Failed to list creations"},{status:500})}}async function d(e){try{let t=await e.formData(),s=t.get("file"),a=t.get("userId")||"anonymous",n=t.get("name")||"Untitled",o=t.get("metadata");if(!s)return i.NextResponse.json({success:!1,error:"No file provided"},{status:400});let p=(0,c.join)(l,a);try{await (0,u.readdir)(p)}catch{await r(20629).mkdir(p,{recursive:!0})}let d=Date.now(),g=s.name.split(".").pop(),f=`${d}.${g}`,j=(0,c.join)(p,f),y=await s.arrayBuffer(),h=Buffer.from(y);if(await (0,u.writeFile)(j,h),o){let e=(0,c.join)(p,`${f}.json`);await (0,u.writeFile)(e,o)}let w={id:f,name:n,url:`/api/gallery/${a}/${f}`,createdAt:new Date().toISOString(),type:m(f),metadata:o?JSON.parse(o):void 0};return i.NextResponse.json({success:!0,creation:w})}catch(e){return console.error("Error saving creation:",e),i.NextResponse.json({success:!1,error:"Failed to save creation"},{status:500})}}async function g(e){try{let{searchParams:t}=new URL(e.url),s=t.get("userId")||"anonymous",a=t.get("creationId");if(!a)return i.NextResponse.json({success:!1,error:"Creation ID required"},{status:400});let n=(0,c.join)(l,s,a),o=(0,c.join)(l,s,`${a}.json`);try{await r(20629).unlink(n);try{await r(20629).unlink(o)}catch{}return i.NextResponse.json({success:!0,message:"Creation deleted successfully"})}catch(e){return i.NextResponse.json({success:!1,error:"Creation not found"},{status:404})}}catch(e){return console.error("Error deleting creation:",e),i.NextResponse.json({success:!1,error:"Failed to delete creation"},{status:500})}}function m(e){let t=e.split(".").pop()?.toLowerCase();if(["jpg","jpeg","png","webp","gif"].includes(t||""));else if(["mp4","avi","mov"].includes(t||""))return"video";else if(["mp3","wav","ogg"].includes(t||""))return"audio";return"image"}let f=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/gallery/route",pathname:"/api/gallery",filename:"route",bundlePath:"app/api/gallery/route"},resolvedPagePath:"/home/ubuntu/vertical-fashion-project/app/api/gallery/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:j,staticGenerationAsyncStorage:y,serverHooks:h}=f,w="/api/gallery/route";function x(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},49303:(e,t,r)=>{e.exports=r(30517)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,70],()=>r(35062));module.exports=s})();